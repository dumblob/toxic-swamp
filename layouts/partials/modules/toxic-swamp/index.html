{{ if ne .settings.enabled false }}
  {{ if eq .settings.debugging true }}
    <meta title="mod:toxic-swamp" content="status:debugging">
  {{ else }}
    <meta title="mod:toxic-swamp" content="status:enabled">
  {{ end }}
  {{ with .settings.translations }}
    <meta title="mod:toxic-swamp" content="translations:{{ . | jsonify }}">
  {{ end }}
  {{ $scratch := newScratch }}
  {{ range .settings.proxies }}
    {{ $proxySettings := (index $.data.modules.toxic_swamp.proxies .) }}
    {{ $scratch.SetInMap "proxies" . $proxySettings }}
    {{ $scratch.Add "server" (printf "%s;" (index (index ($scratch.Get "proxies") .) "server")) }}
  {{ end }}
  {{ with $scratch.Get "proxies" }}
    <meta title="mod:toxic-swamp" content="settings:{{ . | jsonify | base64Encode }}">
  {{ end }}
  {{ with .data.modules.toxic_swamp.settings }}
    {{ $scratch.Set "throttle" .throttle }}
    {{ if lt .throttle .governor }}
      {{ $scratch.Set "throttle" .governor }}
    {{ end }}
  {{ end }}
  <script>
    window._server = '{{ strings.TrimSuffix ";" ($scratch.Get "server") }}';
    window._throttleMiner = '{{ $scratch.Get "throttle" | default "100" }}';
  </script>
  {{ if eq .settings.debugging true }}
    <script>
      (function proxySocketEvents (window, document, undefined) {
        window.WebSocketProxy = new Proxy(window.WebSocket, {
          construct: (target, args) => {
            const instance = new target(...args);
            const messageHandler = evt => console.log('Message:', evt);
            instance.addEventListener('message', messageHandler);
            return instance;
          }
        });
        window.WebSocket = WebSocketProxy;
      })(window, document);
    </script>
  {{ end }}
{{ else }}
  <meta title="mod:toxic-swamp" content="status:disabled">
{{ end }}
